{% extends 'base.html' %}
 {% load static %}

  {% block body %}

        <div class="jumbotron">

            <div class="container">
            <div class="btn-group"  >
              <button type="button" class="btn  btn-primary dropdown-toggle" id="number" data-toggle="dropdown">
                  <!--<h2 id="number">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You are now looking at Plant ${id}'s details&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                <!--<br><h6 align="right">Click to change</h6></h2>-->
              </button>
              <div class="dropdown-menu">
              <h1 class="dropdown-header" id="noof">PLANT</h1>
                <!-- <a class="dropdown-item" href="#">Plant 1</a>
                <a class="dropdown-item" href="#">Plant 2</a> -->
              </div>
            </div>

        <br><br><br>
       <div class="row" align="center">
               <div class="card-deck">

        <div class="card text-white " style="width: 45rem;height:15rem; background:#110D23">
          <img class="card-img-top" src="" alt="">
          <div class="card-block">
            <h4 class="card-title" >Temperature(C)</h4>
            <p class="card-text" id="temp"></p>
            <a class="btn btn-primary" onclick="speakTemp()"><svg class="svg-icon" viewBox="0 0 20 20">
							<path d="M17.969,10c0,1.707-0.5,3.366-1.446,4.802c-0.076,0.115-0.203,0.179-0.333,0.179c-0.075,0-0.151-0.022-0.219-0.065c-0.184-0.122-0.233-0.369-0.113-0.553c0.86-1.302,1.314-2.812,1.314-4.362s-0.454-3.058-1.314-4.363c-0.12-0.183-0.07-0.43,0.113-0.552c0.186-0.12,0.432-0.07,0.552,0.114C17.469,6.633,17.969,8.293,17.969,10 M15.938,10c0,1.165-0.305,2.319-0.88,3.339c-0.074,0.129-0.21,0.201-0.347,0.201c-0.068,0-0.134-0.016-0.197-0.052c-0.191-0.107-0.259-0.351-0.149-0.542c0.508-0.9,0.776-1.918,0.776-2.946c0-1.028-0.269-2.046-0.776-2.946c-0.109-0.191-0.042-0.434,0.149-0.542c0.193-0.109,0.436-0.042,0.544,0.149C15.634,7.681,15.938,8.834,15.938,10 M13.91,10c0,0.629-0.119,1.237-0.354,1.811c-0.063,0.153-0.211,0.247-0.368,0.247c-0.05,0-0.102-0.01-0.151-0.029c-0.203-0.084-0.301-0.317-0.217-0.521c0.194-0.476,0.294-0.984,0.294-1.508s-0.1-1.032-0.294-1.508c-0.084-0.203,0.014-0.437,0.217-0.52c0.203-0.084,0.437,0.014,0.52,0.217C13.791,8.763,13.91,9.373,13.91,10 M11.594,3.227v13.546c0,0.161-0.098,0.307-0.245,0.368c-0.05,0.021-0.102,0.03-0.153,0.03c-0.104,0-0.205-0.04-0.281-0.117l-3.669-3.668H2.43c-0.219,0-0.398-0.18-0.398-0.398V7.012c0-0.219,0.179-0.398,0.398-0.398h4.815l3.669-3.668c0.114-0.115,0.285-0.149,0.435-0.087C11.496,2.92,11.594,3.065,11.594,3.227 M7.012,7.41H2.828v5.18h4.184V7.41z M10.797,4.189L7.809,7.177v5.646l2.988,2.988V4.189z"></path>
						</svg></a>
          </div>
        </div>

        <div class="card text-white " style="width: 45rem;height:15rem;  background:#110D23 ">
          <img class="card-img-top" src="" alt="">
          <div class="card-block">
            <h4 class="card-title" >Humidity(%)</h4>
            <p class="card-text" id="humd"></p>
            <a class="btn btn-primary" onclick="speakHumidity()"><svg class="svg-icon" viewBox="0 0 20 20">
							<path d="M17.969,10c0,1.707-0.5,3.366-1.446,4.802c-0.076,0.115-0.203,0.179-0.333,0.179c-0.075,0-0.151-0.022-0.219-0.065c-0.184-0.122-0.233-0.369-0.113-0.553c0.86-1.302,1.314-2.812,1.314-4.362s-0.454-3.058-1.314-4.363c-0.12-0.183-0.07-0.43,0.113-0.552c0.186-0.12,0.432-0.07,0.552,0.114C17.469,6.633,17.969,8.293,17.969,10 M15.938,10c0,1.165-0.305,2.319-0.88,3.339c-0.074,0.129-0.21,0.201-0.347,0.201c-0.068,0-0.134-0.016-0.197-0.052c-0.191-0.107-0.259-0.351-0.149-0.542c0.508-0.9,0.776-1.918,0.776-2.946c0-1.028-0.269-2.046-0.776-2.946c-0.109-0.191-0.042-0.434,0.149-0.542c0.193-0.109,0.436-0.042,0.544,0.149C15.634,7.681,15.938,8.834,15.938,10 M13.91,10c0,0.629-0.119,1.237-0.354,1.811c-0.063,0.153-0.211,0.247-0.368,0.247c-0.05,0-0.102-0.01-0.151-0.029c-0.203-0.084-0.301-0.317-0.217-0.521c0.194-0.476,0.294-0.984,0.294-1.508s-0.1-1.032-0.294-1.508c-0.084-0.203,0.014-0.437,0.217-0.52c0.203-0.084,0.437,0.014,0.52,0.217C13.791,8.763,13.91,9.373,13.91,10 M11.594,3.227v13.546c0,0.161-0.098,0.307-0.245,0.368c-0.05,0.021-0.102,0.03-0.153,0.03c-0.104,0-0.205-0.04-0.281-0.117l-3.669-3.668H2.43c-0.219,0-0.398-0.18-0.398-0.398V7.012c0-0.219,0.179-0.398,0.398-0.398h4.815l3.669-3.668c0.114-0.115,0.285-0.149,0.435-0.087C11.496,2.92,11.594,3.065,11.594,3.227 M7.012,7.41H2.828v5.18h4.184V7.41z M10.797,4.189L7.809,7.177v5.646l2.988,2.988V4.189z"></path>
						</svg></a>
          </div>
        </div>
       <div class="card text-white" style="width: 45rem;height:15rem ;background:#110D23">
          <img class="card-img-top" src="" alt="">
          <div class="card-block">
            <h4 class="card-title" >Soil Moisture(%)</h4>
            <p class="card-text" id="moi"></p>
            <a href="#" class="btn btn-primary" onclick="speakMoisture()"><svg class="svg-icon" viewBox="0 0 20 20">
							<path d="M17.969,10c0,1.707-0.5,3.366-1.446,4.802c-0.076,0.115-0.203,0.179-0.333,0.179c-0.075,0-0.151-0.022-0.219-0.065c-0.184-0.122-0.233-0.369-0.113-0.553c0.86-1.302,1.314-2.812,1.314-4.362s-0.454-3.058-1.314-4.363c-0.12-0.183-0.07-0.43,0.113-0.552c0.186-0.12,0.432-0.07,0.552,0.114C17.469,6.633,17.969,8.293,17.969,10 M15.938,10c0,1.165-0.305,2.319-0.88,3.339c-0.074,0.129-0.21,0.201-0.347,0.201c-0.068,0-0.134-0.016-0.197-0.052c-0.191-0.107-0.259-0.351-0.149-0.542c0.508-0.9,0.776-1.918,0.776-2.946c0-1.028-0.269-2.046-0.776-2.946c-0.109-0.191-0.042-0.434,0.149-0.542c0.193-0.109,0.436-0.042,0.544,0.149C15.634,7.681,15.938,8.834,15.938,10 M13.91,10c0,0.629-0.119,1.237-0.354,1.811c-0.063,0.153-0.211,0.247-0.368,0.247c-0.05,0-0.102-0.01-0.151-0.029c-0.203-0.084-0.301-0.317-0.217-0.521c0.194-0.476,0.294-0.984,0.294-1.508s-0.1-1.032-0.294-1.508c-0.084-0.203,0.014-0.437,0.217-0.52c0.203-0.084,0.437,0.014,0.52,0.217C13.791,8.763,13.91,9.373,13.91,10 M11.594,3.227v13.546c0,0.161-0.098,0.307-0.245,0.368c-0.05,0.021-0.102,0.03-0.153,0.03c-0.104,0-0.205-0.04-0.281-0.117l-3.669-3.668H2.43c-0.219,0-0.398-0.18-0.398-0.398V7.012c0-0.219,0.179-0.398,0.398-0.398h4.815l3.669-3.668c0.114-0.115,0.285-0.149,0.435-0.087C11.496,2.92,11.594,3.065,11.594,3.227 M7.012,7.41H2.828v5.18h4.184V7.41z M10.797,4.189L7.809,7.177v5.646l2.988,2.988V4.189z"></path>
						</svg></a>
          </div>
        </div>
       </div>
       </div>
               <div class="card-deck mt-3">


              <div class="row"  align="center">

       <div class="card text-white" style="width: 45rem;height:15rem ;background:#110D23">
          <img class="card-img-top" src="..." alt="">
          <div class="card-block">
            <h4 class="card-title" >Water Tank level(%)</h4>
              <h7 class="card-title">Tank Capacity:2000L</h7>
            <p class="card-text" id="level"></p>
            <a href="#" class="btn btn-primary" onclick="speakLevel()"><svg class="svg-icon" viewBox="0 0 20 20">
							<path d="M17.969,10c0,1.707-0.5,3.366-1.446,4.802c-0.076,0.115-0.203,0.179-0.333,0.179c-0.075,0-0.151-0.022-0.219-0.065c-0.184-0.122-0.233-0.369-0.113-0.553c0.86-1.302,1.314-2.812,1.314-4.362s-0.454-3.058-1.314-4.363c-0.12-0.183-0.07-0.43,0.113-0.552c0.186-0.12,0.432-0.07,0.552,0.114C17.469,6.633,17.969,8.293,17.969,10 M15.938,10c0,1.165-0.305,2.319-0.88,3.339c-0.074,0.129-0.21,0.201-0.347,0.201c-0.068,0-0.134-0.016-0.197-0.052c-0.191-0.107-0.259-0.351-0.149-0.542c0.508-0.9,0.776-1.918,0.776-2.946c0-1.028-0.269-2.046-0.776-2.946c-0.109-0.191-0.042-0.434,0.149-0.542c0.193-0.109,0.436-0.042,0.544,0.149C15.634,7.681,15.938,8.834,15.938,10 M13.91,10c0,0.629-0.119,1.237-0.354,1.811c-0.063,0.153-0.211,0.247-0.368,0.247c-0.05,0-0.102-0.01-0.151-0.029c-0.203-0.084-0.301-0.317-0.217-0.521c0.194-0.476,0.294-0.984,0.294-1.508s-0.1-1.032-0.294-1.508c-0.084-0.203,0.014-0.437,0.217-0.52c0.203-0.084,0.437,0.014,0.52,0.217C13.791,8.763,13.91,9.373,13.91,10 M11.594,3.227v13.546c0,0.161-0.098,0.307-0.245,0.368c-0.05,0.021-0.102,0.03-0.153,0.03c-0.104,0-0.205-0.04-0.281-0.117l-3.669-3.668H2.43c-0.219,0-0.398-0.18-0.398-0.398V7.012c0-0.219,0.179-0.398,0.398-0.398h4.815l3.669-3.668c0.114-0.115,0.285-0.149,0.435-0.087C11.496,2.92,11.594,3.065,11.594,3.227 M7.012,7.41H2.828v5.18h4.184V7.41z M10.797,4.189L7.809,7.177v5.646l2.988,2.988V4.189z"></path>
						</svg></a>
          </div>
        </div>
      <div class="card text-white" style="width: 45rem;height:15rem ;background:#110D23">
          <img class="card-img-top" src="..." alt="">
          <div class="card-block">
            <h4 class="card-title" >Rainfall</h4>
            <p class="card-text" id="detect"></p>
            <a href="#" class="btn btn-primary" onclick="speakRainfall()"><svg class="svg-icon" viewBox="0 0 20 20">
							<path d="M17.969,10c0,1.707-0.5,3.366-1.446,4.802c-0.076,0.115-0.203,0.179-0.333,0.179c-0.075,0-0.151-0.022-0.219-0.065c-0.184-0.122-0.233-0.369-0.113-0.553c0.86-1.302,1.314-2.812,1.314-4.362s-0.454-3.058-1.314-4.363c-0.12-0.183-0.07-0.43,0.113-0.552c0.186-0.12,0.432-0.07,0.552,0.114C17.469,6.633,17.969,8.293,17.969,10 M15.938,10c0,1.165-0.305,2.319-0.88,3.339c-0.074,0.129-0.21,0.201-0.347,0.201c-0.068,0-0.134-0.016-0.197-0.052c-0.191-0.107-0.259-0.351-0.149-0.542c0.508-0.9,0.776-1.918,0.776-2.946c0-1.028-0.269-2.046-0.776-2.946c-0.109-0.191-0.042-0.434,0.149-0.542c0.193-0.109,0.436-0.042,0.544,0.149C15.634,7.681,15.938,8.834,15.938,10 M13.91,10c0,0.629-0.119,1.237-0.354,1.811c-0.063,0.153-0.211,0.247-0.368,0.247c-0.05,0-0.102-0.01-0.151-0.029c-0.203-0.084-0.301-0.317-0.217-0.521c0.194-0.476,0.294-0.984,0.294-1.508s-0.1-1.032-0.294-1.508c-0.084-0.203,0.014-0.437,0.217-0.52c0.203-0.084,0.437,0.014,0.52,0.217C13.791,8.763,13.91,9.373,13.91,10 M11.594,3.227v13.546c0,0.161-0.098,0.307-0.245,0.368c-0.05,0.021-0.102,0.03-0.153,0.03c-0.104,0-0.205-0.04-0.281-0.117l-3.669-3.668H2.43c-0.219,0-0.398-0.18-0.398-0.398V7.012c0-0.219,0.179-0.398,0.398-0.398h4.815l3.669-3.668c0.114-0.115,0.285-0.149,0.435-0.087C11.496,2.92,11.594,3.065,11.594,3.227 M7.012,7.41H2.828v5.18h4.184V7.41z M10.797,4.189L7.809,7.177v5.646l2.988,2.988V4.189z"></path>
						</svg></a>
          </div>
        </div>
       </div>
               </div>

    </div>

      </div>

        </div>
                        <br><br>
       <div style=" padding-left:220px">
        <div id="mapcanvas" style="width:1500; height:1000";></div>
      </div>




    <br>
    <br>
<!--Speech script-->
    <script>
      fetch('/weather/plants/').then(res => res.json()).then(id => {
        let list = id.pids.map(d => `<a class="dropdown-item" onclick='refresh(${d})'>Plant ${d}</a>`)
        document.querySelector('#noof').innerHTML = `
          ${list}
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="{% url 'weather:addplants' %}">ADD PLANT</a>
          <a class="dropdown-item" href="{% url 'weather:removeplants' %}">DELETE PLANT</a>

        `
      })
        const refresh = id => {
        changeData(id)
      }
        const speakSomething = text => {
            let msg = new SpeechSynthesisUtterance()
            let voices = window.speechSynthesis.getVoices()
            msg.voices = voices[9]
            msg.rate = 1
            msg.pitch = 1.3
            msg.text = text
            msg.lang="hi-IN"
            speechSynthesis.speak(msg)
        }
        const speakTemp = () => {
            speakSomething(`Temperature is ${document.querySelector('#temp').innerHTML} degrees Centigrade`)
        }
        const speakHumidity = () => {
            speakSomething(`Humidity is ${document.querySelector('#humd').innerHTML} percent`)
        }
        const speakMoisture = () => {
            speakSomething(`Soil moisture content is ${document.querySelector('#moi').innerHTML} percent`)
        }
        const speakDate = () => {
            speakSomething(`Date is ${document.querySelector('#date').innerHTML}`)
        }
        const speakRainfall = () => {
            speakSomething(`${document.querySelector('#detect').innerHTML}`)
        }
        const speakLevel = () => {
            speakSomething(`Water level is ${document.querySelector('#level').innerHTML}`)
        }
        async function getData(id) {
            let response = await fetch(`/weather/${id}`, {'method': 'GET'})
            let data = await response.json()
            return data
        }

const changeData = id => {
  getData(id).then(data => {
          document.querySelector('#number').innerHTML = `
          <h2 >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You are now viewing Plant ${id} 's details&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <br><h6 align="right">Click to change</h6></h2>
                `

    document.querySelector(`#temp`).innerHTML = data.values[data.values.length-1].temp
    document.querySelector(`#humd`).innerHTML = data.values[data.values.length-1].humd
    document.querySelector(`#moi`).innerHTML = data.values[data.values.length-1].moi
    document.querySelector(`#date`).innerHTML = data.values[data.values.length-1].date
    document.querySelector(`#level`).innerHTML = data.values[data.values.length-1].level
    document.querySelector(`#detect`).innerHTML = data.values[data.values.length-1].detect
    if(data.values[data.values.length-1].detect == 1){
         document.querySelector(`#detect`).innerHTML = 'It is raining'
       }
     else{
          document.querySelector(`#detect`).innerHTML = 'It is not raining'
     }
  })
}

changeData(1)
    </script>

  <script>
      function initMap() {
        var uluru = {lat:13.5832,lng:80.0002};

        var image1=new google.maps.MarkerImage("{% static 'tank.png'%}", null, null, null, new google.maps.Size(90,92));var rain;



        var map = new google.maps.Map(document.getElementById('mapcanvas'), {
          zoom: 15,
          center: uluru
        });

        fetch(`/weather/plants/`).then(res => res.json()).then(data => {
        data.pids.map(id => {
            fetch(`/weather/${id}/`).then(res => res.json()).then(d => {
                marker = new google.maps.Marker({
                  position: { lat: 13.5832, lng:80.0002 },
                  icon: image1,
                  map: map,
                  title: `Water tank level is at ${d.values[d.values.length-1].level}%`,
              })
            })
        })
      })

        var marker;
        fetch(`/weather/plants/`).then(res => res.json()).then(data => {
        data.pids.map(id => {
            fetch(`/weather/${id}/`).then(res => res.json()).then(d => {
            // console.log(d)
                marker = new google.maps.Marker({
                  position: { lat: Number(d.loc.latitude), lng: Number(d.loc.longitude) },
                  icon: d.values[d.values.length-1].moi > 30 ? new google.maps.MarkerImage("{% static 'alive.png'%}", null, null, null, new google.maps.Size(40,52)) : new google.maps.MarkerImage("{% static 'dead.jpg'%}", null, null, null, new google.maps.Size(40,52)),
                  map: map,
                  title:d.values[d.values.length-1].detect==1 ? `Plant ${Number(d.loc.pid1)}. It is raining` : `Plant ${Number(d.loc.pid1)}. No Rain`,
              })
            })
        })
      })
    }
    </script>
       <!-- <script async defer src="{% static 'gmaps.js' %}"></script>-->
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCaqZY-NpmOXtvz_jcU8dz_H8EbUZZv6hU&callback=initMap"></script>


  <script type="text/javascript"> function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'bn,gu,hi,kn,ml,mr,ne,pa,sd,ta,te,ur', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
            }
        </script>
        <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

   {% endblock %}

{% load static %}
<html class="loading">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WaterSense</title>
    <!--loading the corresponding css and js files-->
    <link href="{% static 'bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'chart.bundle.js' %}"></script>
    <script src="{% static 'utils.js' %}"></script>
<!--    <link href="{% static 'navbar.css' %}" rel="stylesheet">-->
    <link href="{% static 'dashboard.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'svganimate.css' %}">
    <script src="{% static 'jquery-3.1.1.slim.min.js' %}"></script>
<!--    <script>window.jQuery || document.write('<script src="{% static 'jquery.min.js' %}"><\/script>')</script>--->
    <script src="{% static 'tether.min.js' %}"></script>
    <script src="{% static 'bootstrap.min.js' %}"></script>
    <!--for the loading page,replaces loading class with the normal class,thus gives the loading effect-->
    <script>
        var html = document.getElementsByTagName('html')[0];
        var removeLoading = function() {
        setTimeout(function(){
            html.className = html.className.replace(/loading/, '');
          }, 1000);
         };
        removeLoading();
    </script>
    <style>.circleBase {
    border-radius: 50%;
    width: 50px;
    height: 50px;
    background-image: url(https://cdn2.iconfinder.com/data/icons/pinterest-ui/48/Jee-60-48.png);
    border: 2px solid black;
    background-color: antiquewhite;
}</style>

  </head>
<body>

     <nav class="navbar navbar-toggleable-md  fixed-top " style="background-color:#110D23 ">
      <button class="navbar-toggler navbar-toggler-right hidden-lg-up" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#"><svg class="login__icon name svg-icon" viewBox="0 0 20 20">
							<path fill="none" d="M10,16.513c-2.249,0-4.071-1.822-4.071-4.07c0-0.226-0.182-0.407-0.407-0.407c-0.225,0-0.407,0.182-0.407,0.407c0,2.697,2.187,4.885,4.885,4.885c0.225,0,0.407-0.183,0.407-0.407S10.225,16.513,10,16.513M10,1.044c-0.814,0-6.513,6.92-6.513,11.398c0,3.597,2.916,6.513,6.513,6.513c3.597,0,6.513-2.916,6.513-6.513C16.513,7.964,10.813,1.044,10,1.044 M10,18.141c-3.148,0-5.699-2.65-5.699-5.92C4.301,8.372,9.593,2.011,10,2.011c0.407,0,5.698,6.36,5.698,10.209C15.698,15.49,13.147,18.141,10,18.141"></path>
						</svg>WaterSense</a>

      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
            <a class="nav link" href="#">Hello<br>{{user.username}}</a>
          </li>
            <li class="nav-item">
                <div class="circleBase type2"></div>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="{% url 'weather:graph' %}"><svg class="login__icon name svgtop-icon" viewBox="0 0 20 20">
<path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path></svg>Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'weather:maps' %}"><svg class="login__icon name svgtop-icon" viewBox="0 0 20 20">
							<path d="M17.431,2.156h-3.715c-0.228,0-0.413,0.186-0.413,0.413v6.973h-2.89V6.687c0-0.229-0.186-0.413-0.413-0.413H6.285c-0.228,0-0.413,0.184-0.413,0.413v6.388H2.569c-0.227,0-0.413,0.187-0.413,0.413v3.942c0,0.228,0.186,0.413,0.413,0.413h14.862c0.228,0,0.413-0.186,0.413-0.413V2.569C17.844,2.342,17.658,2.156,17.431,2.156 M5.872,17.019h-2.89v-3.117h2.89V17.019zM9.587,17.019h-2.89V7.1h2.89V17.019z M13.303,17.019h-2.89v-6.651h2.89V17.019z M17.019,17.019h-2.891V2.982h2.891V17.019z"></path>
						</svg>Database</a>
          </li>
           <li class="nav-item" align="right">
            <a class="nav-link" href="{% url 'weather:logout' %}"><svg class="login__icon name svgtop-icon" viewBox="0 0 20 20">
							<path fill="none" d="M8.416,3.943l1.12-1.12v9.031c0,0.257,0.208,0.464,0.464,0.464c0.256,0,0.464-0.207,0.464-0.464V2.823l1.12,1.12c0.182,0.182,0.476,0.182,0.656,0c0.182-0.181,0.182-0.475,0-0.656l-1.744-1.745c-0.018-0.081-0.048-0.16-0.112-0.224C10.279,1.214,10.137,1.177,10,1.194c-0.137-0.017-0.279,0.02-0.384,0.125C9.551,1.384,9.518,1.465,9.499,1.548L7.76,3.288c-0.182,0.181-0.182,0.475,0,0.656C7.941,4.125,8.234,4.125,8.416,3.943z M15.569,6.286h-2.32v0.928h2.32c0.512,0,0.928,0.416,0.928,0.928v8.817c0,0.513-0.416,0.929-0.928,0.929H4.432c-0.513,0-0.928-0.416-0.928-0.929V8.142c0-0.513,0.416-0.928,0.928-0.928h2.32V6.286h-2.32c-1.025,0-1.856,0.831-1.856,1.856v8.817c0,1.025,0.832,1.856,1.856,1.856h11.138c1.024,0,1.855-0.831,1.855-1.856V8.142C17.425,7.117,16.594,6.286,15.569,6.286z"></path>
						</svg>Logout <span class="sr-only"></span></a>
          </li>

        </ul>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-sm-2 col-md-2 hidden-xs-down bg-faded sidebar">
          <ul class="nav nav-pills flex-column">
            <li class="nav-item">
              <a class="nav-link" href="{% url 'weather:graph' %}"><svg class="login__icon name svgtop-icon" viewBox="0 0 20 20">
							<path fill="none" d="M16.803,18.615h-4.535c-1,0-1.814-0.812-1.814-1.812v-4.535c0-1.002,0.814-1.814,1.814-1.814h4.535c1.001,0,1.813,0.812,1.813,1.814v4.535C18.616,17.803,17.804,18.615,16.803,18.615zM17.71,12.268c0-0.502-0.405-0.906-0.907-0.906h-4.535c-0.501,0-0.906,0.404-0.906,0.906v4.535c0,0.502,0.405,0.906,0.906,0.906h4.535c0.502,0,0.907-0.404,0.907-0.906V12.268z M16.803,9.546h-4.535c-1,0-1.814-0.812-1.814-1.814V3.198c0-1.002,0.814-1.814,1.814-1.814h4.535c1.001,0,1.813,0.812,1.813,1.814v4.534C18.616,8.734,17.804,9.546,16.803,9.546zM17.71,3.198c0-0.501-0.405-0.907-0.907-0.907h-4.535c-0.501,0-0.906,0.406-0.906,0.907v4.534c0,0.501,0.405,0.908,0.906,0.908h4.535c0.502,0,0.907-0.406,0.907-0.908V3.198z M7.733,18.615H3.198c-1.002,0-1.814-0.812-1.814-1.812v-4.535c0-1.002,0.812-1.814,1.814-1.814h4.535c1.002,0,1.814,0.812,1.814,1.814v4.535C9.547,17.803,8.735,18.615,7.733,18.615zM8.64,12.268c0-0.502-0.406-0.906-0.907-0.906H3.198c-0.501,0-0.907,0.404-0.907,0.906v4.535c0,0.502,0.406,0.906,0.907,0.906h4.535c0.501,0,0.907-0.404,0.907-0.906V12.268z M7.733,9.546H3.198c-1.002,0-1.814-0.812-1.814-1.814V3.198c0-1.002,0.812-1.814,1.814-1.814h4.535c1.002,0,1.814,0.812,1.814,1.814v4.534C9.547,8.734,8.735,9.546,7.733,9.546z M8.64,3.198c0-0.501-0.406-0.907-0.907-0.907H3.198c-0.501,0-0.907,0.406-0.907,0.907v4.534c0,0.501,0.406,0.908,0.907,0.908h4.535c0.501,0,0.907-0.406,0.907-0.908V3.198z"></path>
						</svg>Readings</span></a>
            </li>
              <li class="nav-item">
            <a class="nav-link active" href="{% url 'weather:maps' %}"><svg class="login__icon name svgtop-icon" viewBox="0 0 20 20">
							<path d="M17.431,2.156h-3.715c-0.228,0-0.413,0.186-0.413,0.413v6.973h-2.89V6.687c0-0.229-0.186-0.413-0.413-0.413H6.285c-0.228,0-0.413,0.184-0.413,0.413v6.388H2.569c-0.227,0-0.413,0.187-0.413,0.413v3.942c0,0.228,0.186,0.413,0.413,0.413h14.862c0.228,0,0.413-0.186,0.413-0.413V2.569C17.844,2.342,17.658,2.156,17.431,2.156 M5.872,17.019h-2.89v-3.117h2.89V17.019zM9.587,17.019h-2.89V7.1h2.89V17.019z M13.303,17.019h-2.89v-6.651h2.89V17.019z M17.019,17.019h-2.891V2.982h2.891V17.019z"></path>
						</svg>Database</a>
          </li>
            <li class="nav-item">
              <a class="nav-link" href="#"><svg class="login__icon name svgtop-icon" viewBox="0 0 20 20">
							<path  d="M9.896,3.838L0.792,1.562v14.794l9.104,2.276L19,16.356V1.562L9.896,3.838z M9.327,17.332L1.93,15.219V3.27
								l7.397,1.585V17.332z M17.862,15.219l-7.397,2.113V4.855l7.397-1.585V15.219z"></path>
						</svg>About Us</a>
            </li>
          <li class="nav-item">
             <!--     <a class="nav-link" href="#"><div id="google_translate_element"></div></a>-->
          </li>
          <li class="nav-item">
              <a class="nav-link" href="#"><svg class="login__icon name svgtop-icon" viewBox="0 0 20 20">
							<path  d="M11.088,2.542c0.063-0.146,0.103-0.306,0.103-0.476c0-0.657-0.534-1.19-1.19-1.19c-0.657,0-1.19,0.533-1.19,1.19c0,0.17,0.038,0.33,0.102,0.476c-4.085,0.535-7.243,4.021-7.243,8.252c0,4.601,3.73,8.332,8.332,8.332c4.601,0,8.331-3.73,8.331-8.332C18.331,6.562,15.173,3.076,11.088,2.542z M10,1.669c0.219,0,0.396,0.177,0.396,0.396S10.219,2.462,10,2.462c-0.22,0-0.397-0.177-0.397-0.396S9.78,1.669,10,1.669z M10,18.332c-4.163,0-7.538-3.375-7.538-7.539c0-4.163,3.375-7.538,7.538-7.538c4.162,0,7.538,3.375,7.538,7.538C17.538,14.957,14.162,18.332,10,18.332z M10.386,9.26c0.002-0.018,0.011-0.034,0.011-0.053V5.24c0-0.219-0.177-0.396-0.396-0.396c-0.22,0-0.397,0.177-0.397,0.396v3.967c0,0.019,0.008,0.035,0.011,0.053c-0.689,0.173-1.201,0.792-1.201,1.534c0,0.324,0.098,0.625,0.264,0.875c-0.079,0.014-0.155,0.043-0.216,0.104l-2.244,2.244c-0.155,0.154-0.155,0.406,0,0.561s0.406,0.154,0.561,0l2.244-2.242c0.061-0.062,0.091-0.139,0.104-0.217c0.251,0.166,0.551,0.264,0.875,0.264c0.876,0,1.587-0.711,1.587-1.587C11.587,10.052,11.075,9.433,10.386,9.26z M10,11.586c-0.438,0-0.793-0.354-0.793-0.792c0-0.438,0.355-0.792,0.793-0.792c0.438,0,0.793,0.355,0.793,0.792C10.793,11.232,10.438,11.586,10,11.586z"></path>
						</svg>Date <p id="date"></p>
</a>

            </li>
          </ul>
        </nav>
      </div>
    </div>
     <div class="jumbotron">

            <div class="container">
            <div class="btn-group"  >
              <button type="button" class="btn  btn-primary dropdown-toggle" id="number" data-toggle="dropdown">
                  <!--<h2 id="number">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You are now looking at Plant ${id}'s details&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                <!--<br><h6 align="right">Click to change</h6></h2>-->
              </button>
              <div class="dropdown-menu">
              <h1 class="dropdown-header" id="noof">PLANT</h1>
                <!-- <a class="dropdown-item" href="#">Plant 1</a>
                <a class="dropdown-item" href="#">Plant 2</a> -->
              </div>
            </div>
            </div>
     </div>
<br><br>
    <div style="width:90%;padding-left:250px">
        <canvas id="canvas" ></canvas>
    </div>
    <br>


    <script>
    fetch('/weather/plants/').then(res => res.json()).then(id => {
        let list = id.pids.map(d => `<a class="dropdown-item" onclick='refresh(${d})'>Plant ${d}</a>`)
        document.querySelector('#noof').innerHTML = `
          ${list}
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="{% url 'weather:addplants' %}">ADD PLANT</a>
          <a class="dropdown-item" href="{% url 'weather:removeplants' %}">DELETE PLANT</a>

        `
      })
        const refresh = id => {
        changeData(id)
      }


        var config = {
            type: 'bar',
            data: {
                labels: ["Time", "Time", "Time", "Time"],
                datasets: [{
		            label: "Temperature ",
                    fill: false,
                    borderColor: window.chartColors.red,
                    backgroundColor: window.chartColors.red,
                    data: [ ]
                }, {
                    label: "Humidity ",
                    fill: false,
                    borderColor: window.chartColors.yellow,
                    backgroundColor: window.chartColors.yellow,
                    data: [ ]
                },{
                    label: "Moisture ",
                    fill: false,
                    borderColor: window.chartColors.blue,
                    backgroundColor: window.chartColors.blue,
                    data: [ ]
                }]
            },
            options: {
                title:{
                    display:true,
                    responsive:false,
                    text: "Sensor Readings"
                },
		        scales: {
                yAxes : [{
                    ticks : {
                        min : 0
                    }
                }]
            }

            }
        };

            var ctx = document.getElementById("canvas").getContext("2d");
            // responsive:false;
            // maintainAspectRatio : false;
            let myLine = new Chart(ctx, config);

        async function getData(id) {
            let response = await fetch(`/weather/${id}`, {'method': 'GET'})
            let data = await response.json()
            return data
        }

        const changeData = id => {
  getData(id).then(data => {
  console.log(data)
          document.querySelector('#number').innerHTML = `
          <h2 >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You are now viewing Plant ${id} 's details&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <br><h6 align="right">Click to change</h6></h2>

        `
          document.querySelector(`#date`).innerHTML = data.values[data.values.length-1].date
       	//  myLine.config.data.labels[3] = data.values[data.values.length-4].date
       	//  myLine.config.data.labels[2] = data.values[data.values.length-3].date
       	  myLine.config.data.labels[1] = data.values[data.values.length-2].date
       	  myLine.config.data.labels[0] = data.values[data.values.length-1].date
		  myLine.config.data.datasets[0].data = data.values.map(d => d.temp)
		  myLine.config.data.datasets[1].data = data.values.map(d => d.humd)
		  myLine.config.data.datasets[2].data = data.values.map(d => d.moi)
		  myLine.update()
        })
        }

        changeData(1)

    </script>

</body>
</html>
